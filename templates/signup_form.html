{% extends 'base.html' %}

{% block head %}
  <!-- From https://css-tricks.com/password-strength-meter/ -->
  <!-- Dropbox password strength API -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/zxcvbn/4.2.0/zxcvbn.js">
  </script>
{% endblock %}

{% block content %}
  <div class="row">
    <div class="col-md-12 col-lg-10 mx-auto">
      <form action="/signup" method="POST">
        <div class="form-group row">
          <h3 class="ml-4 ml-sm-0">Signup Form</h3>
        </div>
        <div class="form-group row">
          <label class="col-sm-4 col-md-3 col-form-label" for="input-form-username">
            Username
          </label>
          <div class="col-sm-8 col-md-9 input-group">
            <div class="input-group-prepend">
              <div class="input-group-text">@</div>
            </div>
            <input class="form-control" id="input-form-username"
                   name="username" placeholder="Enter username"
                   required="true" type="text">
          </div>
        </div>
        <div class="form-group row">
          <label class="col-sm-4 col-md-3 col-form-label" for="input-form-email">
            Email address
          </label>
          <div class="col-sm-8 col-md-9">
            <input class="form-control" id="input-form-email" name="email"
                   placeholder="Enter email" required="true" type="email">
          </div>
        </div>
        <div class="form-group row">
          <label class="col-sm-4 col-md-3 col-form-label" for="input-form-password">
            Password
          </label>
          <div class="col-sm-8 col-md-9">
            <input class="form-control" id="input-form-password"
                   name="password" placeholder="Enter password" required="true"
                   type="password">
          </div>
          <p class="d-flex my-0 ml-auto mr-3 small text-muted"
             id="password-strength">&nbsp;</p>
        </div>
        <div class="form-group row">
          <label class="col-sm-4 col-md-3 col-form-label" for="input-form-password">
                Confirm Password
          </label>
          <div class="col-sm-8 col-md-9 input-group">
            <div class="input-group-prepend">
              <div class="input-group-text" style="min-width: 2.5em;">
                <span id="password-match-display"></span>
              </div>
            </div>
            <input class="form-control" id="input-form-password-comfirm"
                   name="password-confirm" placeholder="Re-enter password"
                   required="true" type="password">
          </div>
        </div>
        <div class="d-flex flex-row">
          <button class="btn btn-primary ml-auto" id="signup-btn" type="submit">
            Signup
          </button>
        </div>
      </form>
    </div>
  </div>

  <script type="text/javascript">
    const strengths = {
      0: "Worst",
      1: "Bad",
      2: "Weak",
      3: "Good",
      4: "Strong"
    };
    let username_field = document.querySelector('#input-form-username');
    let email_field = document.querySelector('#input-form-email');
    let password_field = document.querySelector('#input-form-password');
    let comfirm_field = document.querySelector('#input-form-password-comfirm');
    let password_strength = document.querySelector('#password-strength');
    let confirm_display = document.querySelector('#password-match-display')
    let submit_button = document.querySelector('#signup-btn');

    // comfirm password
    function password_check() {
      let password = password_field.value;
      let confirm = comfirm_field.value;
      return password === confirm;
    };

    comfirm_field.addEventListener('input', function() {
      if (password_check()) {
        confirm_display.innerHTML = '<span class="oi oi-circle-check"></span>';
      } else {
        confirm_display.innerHTML = '<span class="oi oi-circle-x"></span>';
      }
    });

    // password strength
    password_field.addEventListener('input', function() {
      let password = password_field.value;
      let result = zxcvbn(password);
      if (password !== "") {
        password_strength.innerHTML = "Strength: " + strengths[result.score];
      } else {
        password_strength.innerHTML = "&nbsp;";
      }
    });

    // form submit checks
    signup_button.addEventListener('submit', function(e) {
      if (!password_check()) {
        e.preventDefault();
      }
    });
  </script>
{% endblock %}
